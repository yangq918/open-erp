<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Open ERP</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
    <script src="assets/js/echarts.min.js"></script>
    <link rel="stylesheet" href="assets/css/amazeui.min.css"/>
    <link rel="stylesheet" href="assets/css/amazeui.datatables.min.css"/>

    <link rel="stylesheet" href="assets/css/fullcalendar.min.css"/>
    <link rel="stylesheet" href="assets/css/fullcalendar.print.css" media='print'/>
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" href="assets/css/custom.css">
    <script src="assets/js/jquery.min.js"></script>

</head>

<body data-type="index">
<script src="assets/js/theme.js"></script>
<div class="am-g tpl-g">
    <!-- 头部 -->
    <header>
        <!-- logo -->
        <div class="am-fl tpl-header-logo">
            <a href="javascript:;"><img src="assets/img/logo.png" alt=""></a>
        </div>
        <!-- 右侧内容 -->
        <div class="tpl-header-fluid">
            <!-- 侧边切换 -->
            <div class="am-fl tpl-header-switch-button am-icon-list">
                    <span>

                </span>
            </div>
            <!-- 搜索 -->

            <!-- 其它功能-->
            <div class="am-fr tpl-header-navbar">
                <ul>
                    <!-- 欢迎语 -->
                    <li class="am-text-sm tpl-header-navbar-welcome">
                        <a href="javascript:;">欢迎你, <span name="user_name_span">测试账号</span> </a>
                    </li>


                    <!-- 退出 -->
                    <li class="am-text-sm">
                        <a href="javascript:void(0);" id="logout_a">
                            <span class="am-icon-sign-out"></span> 退出
                        </a>
                    </li>
                </ul>
            </div>
        </div>

    </header>
    <!-- 风格切换 -->
    <div class="tpl-skiner">
        <div class="tpl-skiner-toggle am-icon-cog">
        </div>
        <div class="tpl-skiner-content">
            <div class="tpl-skiner-content-title">
                选择主题
            </div>
            <div class="tpl-skiner-content-bar">
                <span class="skiner-color skiner-white" data-color="theme-white"></span>
                <span class="skiner-color skiner-black" data-color="theme-black"></span>
            </div>
        </div>
    </div>
    <!-- 侧边导航栏 -->
    <div class="left-sidebar">
        <!-- 用户信息 -->
        <div class="tpl-sidebar-user-panel">
            <div class="tpl-user-panel-slide-toggleable">
                <div class="tpl-user-panel-profile-picture">
                    <img id="user_img_id" src="assets/img/user02.png" alt="">
                </div>
                <span class="user-panel-logged-in-text">
              <i class="am-icon-circle-o am-text-success tpl-user-panel-status-icon"></i>
              <span name="user_name_span">测试账号</span>
          </span>

            </div>
        </div>

        <!-- 菜单 -->
        <ul class="sidebar-nav">
            <li class="sidebar-nav-heading">常用功能</li>
            <li class="sidebar-nav-link">
                <a href="index.html">
                    <i class="am-icon-home sidebar-nav-link-logo"></i> 首页
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="proinventroy.html">
                    <i class="am-icon-wpforms sidebar-nav-link-logo"></i> 库存管理
                </a>
            </li>
            <li class="sidebar-nav-heading">系统管理</li>
            <li class="sidebar-nav-link only_manage_menu">
                <a href="users.html" class="active">
                    <i class="am-icon-users sidebar-nav-link-logo"></i> 账号管理
                </a>
            </li>
            <li class="sidebar-nav-link">
                <a href="user.html">
                    <i class="am-icon-user sidebar-nav-link-logo"></i> 个人中心
                </a>
            </li>


        </ul>
    </div>


    <!-- 内容区域 -->
    <div class="tpl-content-wrapper">

        <div class="container-fluid am-cf">
            <div class="row">
                <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
                    <div class="page-header-heading"><span class="am-icon-users page-header-heading-icon"></span> 账号管理
                    </div>

                </div>

            </div>

        </div>

        <div class="row">
            <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                <div class="widget am-cf">
                    <div class="widget-head am-cf">
                        <div class="widget-title am-fl">账号信息</div>

                    </div>

                    <div class="widget-body  widget-body-lg am-fr">
                        <div class="am-u-sm-12 am-u-md-6 am-u-lg-6">
                            <div class="am-form-group">
                                <div class="am-btn-toolbar">
                                    <div class="am-btn-group am-btn-group-xs">
                                        <button id="add_btn" type="button" class="am-btn am-btn-default am-btn-success"><span
                                                class="am-icon-plus"></span> 新增账号
                                        </button>

                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="am-u-sm-12 am-u-md-12 am-u-lg-3">
                            <div style="text-align: right;">账号/名称:</div>
                        </div>
                        <div class="am-u-sm-12 am-u-md-12 am-u-lg-3">
                            <div class="am-input-group am-input-group-sm tpl-form-border-form cl-p">
                                <input type="text" id="searchValue" class="am-form-field ">
                                <span class="am-input-group-btn">
            <button id="search_btn" class="am-btn  am-btn-default am-btn-success tpl-table-list-field am-icon-search"
                    type="button"></button>
          </span>
                            </div>
                        </div>
                        <div class="am-u-sm-12">
                            <table width="100%"
                                   class="am-table am-table-compact tpl-table-black am-table-hover am-table-bordered am-table-radius"
                                   id="users_table_id">
                                <thead>
                                <tr>
                                    <th style="width: 20%">账号</th>
                                    <th style="width: 20%">名称</th>
                                    <th style="width: 10%">账号类型</th>
                                    <th style="width: 20%">注册时间</th>
                                    <th style="width: 25%">操作</th>
                                </tr>
                                </thead>
                                <tbody>

                                <!-- more data -->
                                </tbody>
                            </table>
                        </div>
                        <div class="am-u-lg-12 am-cf">

                            <div class="am-fr">

                                <ul id="page_ul" class="am-pagination tpl-pagination">
                                    <li>
                                        <div class="p_total_size" style="display: inline">共0条,0页</div>
                                    </li>
                                    <li><a href="javascript:void(0);" class="am-btn p_first_page">首页</a></li>
                                    <li><a href="javascript:void(0);" class="am-btn p_pre_page">«</a></li>
                                    <li class="am-active"><a href="javascript:void(0);" class="p_current_size">0</a>
                                    </li>
                                    <li><a href="javascript:void(0);" class="am-btn p_next_page">»</a></li>
                                    <li><a href="javascript:void(0);" class="am-btn p_last_page">尾页</a></li>
                                    <li>
                                        <div>到第<input type="text" class="tpl-form-input p_jump_input"
                                                      style="width: 30px" name="pageNum" id="pageNum">页
                                        </div>
                                    </li>
                                    <li>
                                        <button id="jumpTo" type="button"
                                                class="p_jump_to am-btn am-btn-default am-btn-xs am-btn-success"></span>
                                            确定
                                        </button>
                                    </li>
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="am-modal am-modal-no-btn" tabindex="-1" id="add-user-modal">
        <div class="am-modal-dialog cus_modal_div">
            <div class="am-modal-hd text-color">新增账号
                <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
            </div>
            <div class="am-modal-bd">
                <div class="widget-body am-fr">

                    <form class="am-form tpl-form-line-form add_form">
                        <div class="am-form-group">
                            <label for="a_account" class="am-u-sm-3 am-form-label">账号</label>
                            <div class="am-u-sm-9">
                                <input type="text" class="tpl-form-input cus_form_input" name="account" id="a_account"
                                       placeholder="请输入账号">
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="a_userName" class="am-u-sm-3 am-form-label">姓名</label>
                            <div class="am-u-sm-9">
                                <input type="text" class="tpl-form-input cus_form_input" name="userName" id="a_userName"
                                       placeholder="请输入姓名">
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="a_type" class="am-u-sm-3 am-form-label">账号类型</label>
                            <div class="am-u-sm-9" style="text-align: left">
                                <select id="a_type" name="type" data-am-selected>
                                    <option value="0">管理员</option>
                                    <option value="1">普通账号</option>
                                </select>
                            </div>
                        </div>


                        <div class="am-form-group">
                            <div class="am-u-sm-9 am-u-sm-push-2">
                                <button type="button" id="add_user_btn"
                                        class="am-btn am-btn-primary tpl-btn-bg-color-success ">提交
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="am-modal am-modal-no-btn" tabindex="-1" id="mod-pwd-modal">
        <div class="am-modal-dialog cus_modal_div">
            <div class="am-modal-hd text-color">重置密码
                <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
            </div>
            <div class="am-modal-bd">
                <div class="widget-body am-fr">

                    <form class="am-form tpl-form-line-form add_form">
                        <div class="am-form-group">
                            <label for="m_account" class="am-u-sm-3 am-form-label">账号</label>
                            <div class="am-u-sm-9">
                                <input type="text" class="tpl-form-input cus_form_input" name="account" id="m_account"
                                       >
                                <input id="m_id" type="hidden" />
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="m_userName" class="am-u-sm-3 am-form-label">姓名</label>
                            <div class="am-u-sm-9">
                                <input type="text" class="tpl-form-input cus_form_input" name="userName" id="m_userName"
                                      >
                            </div>
                        </div>
                        <div class="am-form-group">
                            <label for="m_userName" class="am-u-sm-3 am-form-label">密码</label>
                            <div class="am-u-sm-9">
                                <input type="password" class="tpl-form-input cus_form_input" name="password" id="m_password"
                                       placeholder="请输入密码">
                            </div>
                        </div>


                        <div class="am-form-group">
                            <div class="am-u-sm-9 am-u-sm-push-2">
                                <button type="button" id="mod_password_btn"
                                        class="am-btn am-btn-primary tpl-btn-bg-color-success ">重置密码
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script src="assets/js/amazeui.min.js"></script>
<script src="assets/js/amazeui.datatables.min.js"></script>
<script src="assets/js/dataTables.responsive.min.js"></script>
<script src="assets/js/moment.js"></script>
<script src="assets/js/app.js"></script>

</body>
<script>
    $(document).ready(function () {
        showUser();

        var userColumns = [{"data": "account", "width": "20%"},
            {"data": "userName", "width": "20%"}, {
                "data": "type", "width": "20%", render: function (data, type, row, meta) {
                    var $data = data;
                    if ("1" == $data) {
                        return "普通账号";
                    }
                    else {
                        return "管理员";
                    }
                }
            }, {"data": "createDate", "width": "20%"},
            {
                "data": null, "width": "40%", render: function (data, type, row, meta) {

                    var rowIndex = meta.row;
                    return "<div class=\"am-btn-group am-btn-group-xs\">\n" +
                        "                                                <button type=\"button\" onclick='modifyPasswd(" + rowIndex + ",event)' class=\"am-btn am-btn-default am-btn-warning\"><span class=\"am-icon-pencil\"></span> 重置密码</button>\n" +
                        "                                                <button type=\"button\" onclick='del(" + rowIndex + ",event)' class=\"am-btn am-btn-default am-btn-danger\"><span class=\"am-icon-trash-o\"></span> 删除</button>\n" +
                        "                                            </div>"
                }
            }
        ];
        var $userTable = $('#users_table_id').DataTable({
            bInfo: false, //页脚信息
            dom: 'ti',
            ordering: false,
            columns: userColumns
        });
        renderTable($userTable, "/api/user/listUser", {"pageNumber": "0"}, $("#page_ul"));

        $("#add_btn").click(function () {
            $('#add-user-modal').modal();
            $("#a_account").val("");
            $("#a_userName").val("");

            $("#add_user_btn").removeAttr("disabled");
            swithModalTheme();
        });

        $("#add_user_btn").click(function () {


            var data = {
                "userName": $("#a_userName").val(),
                "password": "000000",
                "account": $("#a_account").val(),
                "type": $("#a_type").val()
            };
            $("#add_user_btn").attr("disabled", "disabled");
            $.post("/api/user/addUser", data, function (result) {
                $("#add_user_btn").removeAttr("disabled");
                console.log(result);
                if ("0" != result.code) {
                    alert(result.msg);
                    return;
                }
                renderTable($userTable, "/api/user/listUser", {"pageNumber": "0"}, $("#page_ul"));
                $('#add-user-modal').modal("close");
            });
        });

        $("#mod_password_btn").click(function () {
            var data = {
                "userId": $("#m_id").val(),
                "passWord": $("#m_password").val()
            };
            $("#mod_password_btn").attr("disabled", "disabled");
            $.post("/api/user/resetPassword", data, function (result) {
                $("#mod_password_btn").removeAttr("disabled");
                console.log(result);
                if ("0" != result.code) {
                    alert(result.msg);
                    return;
                }
                alert("重置密码成功!")
                $('#mod-pwd-modal').modal("close");
            });
        });
        
        $("#search_btn").click(function () {
            var params = toPageParams(0);
            renderTable($userTable, "/api/user/listUser", params, $("#page_ul"));
        });


        $("#page_ul .p_first_page").click(function () {

            console.log("p_first_page");
            var params = toPageParams(0);
            renderTable($userTable, "/api/user/listUser", params, $("#page_ul"));
        });

        $("#page_ul .p_last_page").click(function () {
            console.log("p_last_page");
            var totalPages = $("#page_ul").attr("totalPages");
            var pageNumber = 0;
            if (null == totalPages) {
                pageNumber = 0;
            }
            else {
                pageNumber = totalPages - 1;
            }
            var params = toPageParams(pageNumber);
            renderTable($userTable, "/api/user/listUser", params, $("#page_ul"));
        });

        $("#page_ul .p_pre_page").click(function () {
            console.log("p_pre_page");
            var currentPage = $("#page_ul").attr("currentPage");
            if (null == currentPage) {
                currentPage = 0;
            }
            var pageNumber = 0;
            if (currentPage <= 0) {
                pageNumber = 0;
            }
            else {
                pageNumber = parseInt(currentPage, 10) - 1;
            }
            var params = toPageParams(pageNumber);
            renderTable($userTable, "/api/user/listUser", params, $("#page_ul"));
        });

        $("#page_ul .p_next_page").click(function () {
            console.log("p_next_page");

            var currentPage = $("#page_ul").attr("currentPage");
            console.log(currentPage);
            if (null == currentPage) {
                currentPage = 0;
            }
            var pageNumber = 0;
            if (currentPage < 0) {
                pageNumber = 0;
            }
            else {
                pageNumber = parseInt(currentPage, 10) + 1;
            }
            var params = toPageParams(pageNumber);
            renderTable($userTable, "/api/user/listUser", params, $("#page_ul"));
        });

        $("#page_ul .p_jump_to").click(function () {
            console.log("p_jump_to");

            var pageNumber = $("#page_ul .p_jump_input").val();
            if (null == pageNumber || "" == pageNumber.trim()) {
                return;
            }
            var pageNumber = parseInt(pageNumber, 10) - 1;
            var params = toPageParams(pageNumber);
            renderTable($userTable, "/api/user/listUser", params, $("#page_ul"));
        });
    });


    function modifyPasswd(rowIndex,event) {
        $('#mod-pwd-modal').modal();
        var $table = $('#users_table_id').DataTable();
        var $data = $table.row(rowIndex).data();
        console.log("modifyPasswd");
        console.log($data);
        $("#m_id").val($data.id);
        $("#m_password").val("");
        $("#m_account").val($data.account);
        $("#m_userName").val($data.userName);
        swithModalTheme();
        $("#mod_password_btn").removeAttr("disabled");
        return false;
    }

    function del(rowIndex) {

        var r = confirm("确认删除该账号?")
        if (r == false) {
            return;
        }


        var $table = $('#users_table_id').DataTable();
        var $data = $table.row(rowIndex).data();

        var userId = $data.id;
        var data = {"id": userId};
        $.post("/api/user/del", data, function (result) {
            console.log(result);
            if ("0" != result.code) {
                alert(result.msg);
                return;
            }
            var params = toPageParams(0);
            var $table = $('#users_table_id').DataTable();
            renderTable($table, "/api/user/listUser", {"pageNumber": "0"}, $("#page_ul"));

        });
        return false;

    }

    function toPageParams(pageNumber) {

        var searchValue = $("#searchValue").val();

        if (null == searchValue) {
            searchValue = "";
        }

        if (null == pageNumber) {
            pageNumber = 0;
        }

        return {"searchValue": searchValue, "pageNumber": pageNumber};
    }


</script>
</html>